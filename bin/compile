#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -o pipefail

BUILD_DIR=$1
CACHE_DIR=$2

cd $BUILD_DIR

# dependencies
#while read url; do
#  echo Vendoring $url
#  curl -s $url | tar xz
#done < vendor_urls
echo "-----> Vendoring cmake"
curl -s https://cmake.org/files/v3.11/cmake-3.11.1.tar.gz | tar xz
cd cmake-3.11.1
./configure
make install
cd ..
ls /usr/local/bin

# configure
if [ -f $1/prepare.py ]; then
  echo "-----> Configuring"
  ./prepare.py
fi

# make
echo "-----> Compiling with Make"
make -C WORK/flexisip/cmake
