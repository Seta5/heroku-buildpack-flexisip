#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
set -o pipefail

BUILD_DIR=$1
CACHE_DIR=$2

cd $BUILD_DIR
ls $(dirname $0)

# dependencies
while read url; do
  echo Vendoring $url
  curl -s $url | tar xz
done < vendor_urls

ls $(dirname $0)
export PATH=$PATH:$BUILD_DIR/*/bin
echo $PATH

# configure
if [ -f $1/prepare.py ]; then
  echo "-----> Configuring"
  ./prepare.py
fi

# make
echo "-----> Compiling with Make"
make -C WORK/flexisip/cmake
